<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>A new way to work with Ansible on the command line.</title>
    <meta name="generator" content="pandoc">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="author" content="Asanka Herath">
    <meta name="description" content="A little bit of command-line sugar to make it easier to run ad-hoc playbooks and tasks against predefined groups of machines.">
    <meta name="keywords" content="ansible, ansible-playbook, command-line">
    <link rel="stylesheet" href="stylesheets/article.css">
    <link rel="stylesheet" href="stylesheets/normalize.css">
    <link rel="stylesheet" href="stylesheets/highlight.css">
    <script src="javascripts/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <section class="buttons">
      <a href="https://asankah.github.io/" class="btn">Home</a>
      <a href="https://github.com/asankah/identity-domains" class="btn">View on GitHub</a>
      <a href="https://github.com/asankah/identity-domains/issues" class="btn">Issues</a>
      <a href="https://github.com/asankah/identity-domains/issues/new" class="btn">New Issue</a>
    </section>
    <section class="main-content">
<h1 id="a-new-way-to-work-with-ansible-on-the-command-line">A new way to work with Ansible on the command line</h1>
<p>This article is about using <a href="https://ansible.com">Ansible</a> on the command-line.</p>
<h2 id="problem">Problem:</h2>
<p>You …</p>
<ul>
<li>
<p>… want a convenient way to do ad-hoc tasks on a bunch of machines.</p>
</li>
<li>
<p>… already have a few playbooks and machine groups defined in your inventory.</p>
</li>
<li>
<p>… don’t want to invest too much into Ansible because you have other things to do and Ansible is just a tool to deal with one aspect of what you want to do.</p>
</li>
<li>
<p>… live on the command-line.</p>
</li>
<li>
<p>… <code>ansible-playbook</code> and <code>ansible</code> commands have too many knobs and too few knobs at the same time.</p>
</li>
</ul>
<h2 id="possible-solution">Possible solution</h2>
<p>Taking a page from old school Posix tools, let’s make a script that encodes Ansible group names into the filename.</p>
<p>E.g.: Instead of:</p>
<pre class="sh"><code>$ ansible atlanta -m copy -a &quot;src=/etc/hosts dest=/tmp/hosts&quot;
$ ansible webservers -m service -a &quot;name=httpd state=started&quot;</code></pre>
<p>You could do:</p>
<pre class="sh"><code>$ atlanta copy &quot;src=/etc/hosts dest=/tmp/hosts&quot;
$ webservers service &quot;name=https state=started&quot;</code></pre>
<p>E.g. Or better, instead of:</p>
<pre class="sh"><code>$ ansible-playbook -l atlanta go-to-the-moon
$ ansible-playbook -l webservers do-the-other-things</code></pre>
<p>You could say:</p>
<pre class="sh"><code>$ atlanta go-to-the-moon
$ webservers do-the-other-things</code></pre>
<h2 id="setting-it-up">Setting it up</h2>
<p>These are just examples. Please don’t spend time bikeshedding names because you can use whichever names you like.</p>
<ol>
<li><p>Start with a file called <code>ansible-by-proxy</code> which looks like <a href="https://github.com/asankah/ansible-cli-sugar/blob/master/ansible-by-proxy">this</a>. Feel free to modify it to suit your environment.</p>
<p>Note that the script expects to find a sub-directory called <code>ansible</code> in the same directory as the script which contains the playbooks and the inventory file.</p></li>
<li><p>Store this file somewhere on the system <code>PATH</code>.</p>
<p>Don’t forget to mark the file as executable if it isn’t already.</p>
<pre class="sh"><code>$ chmod +x ansible-by-proxy</code></pre></li>
<li><p>In that same directory, create symlinks to the file that have the same name as:</p>
<pre class="sh"><code>$ ln -s ansible-by-proxy atlanta
$ ln -s ansible-by-proxy webservers</code></pre>
<p>and so on.</p></li>
</ol>
<p>That’s it. Now you can invoke playbooks and tasks just by using the name of host or group.</p>

    </section>

  </body>
</html>
